import{_ as e,c as s,o as t,U as i}from"./chunks/framework.lgX5_p8q.js";const f=JSON.parse('{"title":"Contexts","description":"","frontmatter":{},"headers":[],"relativePath":"ru/guide/contexts.md","filePath":"ru/guide/contexts.md"}'),a={name:"ru/guide/contexts.md"},r=i(`<h1 id="contexts" tabindex="-1">Contexts <a class="header-anchor" href="#contexts" aria-label="Permalink to &quot;Contexts&quot;">​</a></h1><p>Описание принципов работы с контекстами</p><h2 id="описание-типов" tabindex="-1">Описание типов <a class="header-anchor" href="#описание-типов" aria-label="Permalink to &quot;Описание типов&quot;">​</a></h2><p><a href="https://negezor.github.io/vk-io/references/vk-io/classes/Context.html" target="_blank" rel="noreferrer">Attachment API Reference [EN]</a></p><h2 id="инициализация" tabindex="-1">Инициализация <a class="header-anchor" href="#инициализация" aria-label="Permalink to &quot;Инициализация&quot;">​</a></h2><p><a href="https://negezor.github.io/vk-io/references/vk-io/interfaces/IContextOptions.html" target="_blank" rel="noreferrer">Опции конструктора</a></p><h2 id="концепция" tabindex="-1">Концепция <a class="header-anchor" href="#концепция" aria-label="Permalink to &quot;Концепция&quot;">​</a></h2><p>Представляет из себя базовый класс для работы с контекстами. Контексты проходят через <a href="https://ru.wikipedia.org/wiki/%D0%A1%D0%B2%D1%8F%D0%B7%D1%83%D1%8E%D1%89%D0%B5%D0%B5_%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%BD%D0%BE%D0%B5_%D0%BE%D0%B1%D0%B5%D1%81%D0%BF%D0%B5%D1%87%D0%B5%D0%BD%D0%B8%D0%B5" target="_blank" rel="noreferrer">middleware</a>, позволяя себя модифицировать.</p><p>У каждого контекста есть описание типов вызываемых событий</p><ul><li><a href="https://negezor.github.io/vk-io/references/vk-io/classes/Context.html#type" target="_blank" rel="noreferrer">type</a> — основной тип контекста (например <code>message</code>)</li><li><a href="https://negezor.github.io/vk-io/references/vk-io/classes/Context.html#subTypes" target="_blank" rel="noreferrer">subTypes</a> — подтипы контекста (например <code>[message_new, chat_kick_user]</code>)</li></ul><p>Для удобного определения контекста, есть метод <a href="https://negezor.github.io/vk-io/references/vk-io/classes/Context.html#is" target="_blank" rel="noreferrer">context.is()</a>, позволяет искать сразу по типу и подтипу. Производит поиск пока не найдёт одно подходящее значение.</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Context { type: &#39;message&#39;, subTypes: [...] }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">context.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">is</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;message&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// =&gt; true</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Context { type: &#39;message&#39;, subTypes: [&#39;chat_invite_user_by_link&#39;] }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">context.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">is</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;chat_invite_user&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;chat_invite_user_by_link&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// =&gt; true</span></span></code></pre></div><p>В каждом контексте, так же есть стандартное пространство для хранения простых состояний, в свойстве <a href="https://negezor.github.io/vk-io/references/vk-io/classes/Context.html#state" target="_blank" rel="noreferrer">state</a></p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">updates.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;message_new&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">next</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    context.state.user </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetchUser</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(context.senderId);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // При этом ничего вам не мешает расширить сам контекст</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // context.user = await fetchUser(context.senderId);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> next</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><p>Список контекстов:</p><ul><li><a href="https://negezor.github.io/vk-io/references/vk-io/classes/VoteContext.html" target="_blank" rel="noreferrer">VoteContext</a></li><li><a href="https://negezor.github.io/vk-io/references/vk-io/classes/LikeContext.html" target="_blank" rel="noreferrer">LikeContext</a></li><li><a href="https://negezor.github.io/vk-io/references/vk-io/classes/TypingContext.html" target="_blank" rel="noreferrer">TypingContext</a></li><li><a href="https://negezor.github.io/vk-io/references/vk-io/classes/CommentContext.html" target="_blank" rel="noreferrer">CommentContext</a></li><li><a href="https://negezor.github.io/vk-io/references/vk-io/classes/MessageContext.html" target="_blank" rel="noreferrer">MessageContext</a></li><li><a href="https://negezor.github.io/vk-io/references/vk-io/classes/WallPostContext.html" target="_blank" rel="noreferrer">WallPostContext</a></li><li><a href="https://negezor.github.io/vk-io/references/vk-io/classes/GroupUserContext.html" target="_blank" rel="noreferrer">GroupUserContext</a></li><li><a href="https://negezor.github.io/vk-io/references/vk-io/classes/DialogFlagsContext.html" target="_blank" rel="noreferrer">DialogFlagsContext</a></li><li><a href="https://negezor.github.io/vk-io/references/vk-io/classes/MarketOrderContext.html" target="_blank" rel="noreferrer">MarketOrderContext</a></li><li><a href="https://negezor.github.io/vk-io/references/vk-io/classes/GroupUpdateContext.html" target="_blank" rel="noreferrer">GroupUpdateContext</a></li><li><a href="https://negezor.github.io/vk-io/references/vk-io/classes/GroupMemberContext.html" target="_blank" rel="noreferrer">GroupMemberContext</a></li><li><a href="https://negezor.github.io/vk-io/references/vk-io/classes/MessageEventContext.html" target="_blank" rel="noreferrer">MessageEventContext</a></li><li><a href="https://negezor.github.io/vk-io/references/vk-io/classes/MessagesReadContext.html" target="_blank" rel="noreferrer">MessagesReadContext</a></li><li><a href="https://negezor.github.io/vk-io/references/vk-io/classes/MessageFlagsContext.html" target="_blank" rel="noreferrer">MessageFlagsContext</a></li><li><a href="https://negezor.github.io/vk-io/references/vk-io/classes/VKAppPayloadContext.html" target="_blank" rel="noreferrer">VKAppPayloadContext</a></li><li><a href="https://negezor.github.io/vk-io/references/vk-io/classes/DonutWithdrawContext.html" target="_blank" rel="noreferrer">DonutWithdrawContext</a></li><li><a href="https://negezor.github.io/vk-io/references/vk-io/classes/NewAttachmentsContext.html" target="_blank" rel="noreferrer">NewAttachmentsContext</a></li><li><a href="https://negezor.github.io/vk-io/references/vk-io/classes/FriendActivityContext.html" target="_blank" rel="noreferrer">FriendActivityContext</a></li><li><a href="https://negezor.github.io/vk-io/references/vk-io/classes/DialogMessagesContext.html" target="_blank" rel="noreferrer">DialogMessagesContext</a></li><li><a href="https://negezor.github.io/vk-io/references/vk-io/classes/VKPayTransactionContext.html" target="_blank" rel="noreferrer">VKPayTransactionContext</a></li><li><a href="https://negezor.github.io/vk-io/references/vk-io/classes/DonutSubscriptionContext.html" target="_blank" rel="noreferrer">DonutSubscriptionContext</a></li><li><a href="https://negezor.github.io/vk-io/references/vk-io/classes/MessageSubscriptionContext.html" target="_blank" rel="noreferrer">MessageSubscriptionContext</a></li><li><a href="https://negezor.github.io/vk-io/references/vk-io/classes/DonutSubscriptionPriceContext.html" target="_blank" rel="noreferrer">DonutSubscriptionPriceContext</a></li><li><a href="https://negezor.github.io/vk-io/references/vk-io/classes/DialogNotificationSettingsContext.html" target="_blank" rel="noreferrer">DialogNotificationSettingsContext</a></li></ul><div class="warning custom-block"><p class="custom-block-title">Внимание</p><p>Контексты могут содержать неполные данные, если например вы получаете их с User Long Poll.</p></div><h2 id="сериализация-контекста" tabindex="-1">Сериализация контекста <a class="header-anchor" href="#сериализация-контекста" aria-label="Permalink to &quot;Сериализация контекста&quot;">​</a></h2><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stringify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(context); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// =&gt; object</span></span></code></pre></div>`,19),n=[r];function l(o,h,k,p,g,c){return t(),s("div",null,n)}const u=e(a,[["render",l]]);export{f as __pageData,u as default};
